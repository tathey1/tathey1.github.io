---
title: 'Mathematics of MYHockey Rankings'
date: 2024-02-20
permalink: /posts/2024/02/myhockey/
tags:
  - cool posts
---

I recently move to Massachusetts where the youth sport of choice is ice hockey. I was watching my cousin play a game and, between the crashes of body checks into the boards that made me fear for my cousin's life, my uncle told me about a website where he gets his intel on the other teams - [myhockeyrankings.com](https://myhockeyrankings.com/index.php).

From what I can understand, the website was developed about 20 years ago by some hockey parent(s) who wanted to quantitatively compare teams that didn't play each other. According to a [post on their website](https://myhockeyrankings.com/news.php?b=305), each team is given a "Ranking" which is computed to be the sum of their "Sched" score (the average strength of their opponents), and their "AGD" (average goal differential, with a single game differential capped at 7). While some details are still not clear to me (e.g. Does the Sched score only include opponents that have already been played that season or does it include future opponents? Is the Sched score computed using rankings at the end of last season or are these rankings updated throughout the season?), there is still enough to tempt me into some mathematical analysis.

We will examine how current rankings are computed. We will assume:

- Sched scores only include opponents that have already been played that season
- Sched scores are based on rankings from the previous year.

If there are $D$ teams in a league, let $r \in \R^D$ be the vector of rankings for each of the teams where $r_i$ is the ranking of team $i$:

$$r=\begin{pmatrix}
r_1 \\
r_2 \\
... \\
r_D
\end{pmatrix}$$

We will denote the rankings at the end of the previous year as $r^{(prev)}$.

Then, let $S$ be the matrix that contains schedule information. Element $S_{ij}$ is the number of times that team $i$ played team $j$. As an example, in a league with 4 teams, say just team 1 plaued team 2, and team 3 played team 4. Then, our $S$ matrix is:

$$S=\begin{pmatrix}
0 & 1 & 0 & 0 \\
1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 \\
0 & 0 & 1 & 0
\end{pmatrix}$$

Next, $\Delta$ be the vector of goals scored minus goals yielded for each team. For example, if team $i$ scored 5 goals and yielded 2 goals, then $\Delta_i=3$. We will examine this system under a variety of settings, starting with a simple setting.

a) Each team plays $n$ games, no scoring cap
=

In this case, the Sched score is given as $\frac{1}{n}Sr^{(prev)}$ and the AGD score is $\frac{1}{n}\Delta$, so the current rankings formula is:

$$
\begin{align*}
r&=\frac{1}{n}Sr^{(prev)} + \frac{1}{n}\Delta \\
&=\frac{1}{n}(Sr^{(prev)}+\Delta)
\end{align*}
$$

When does a ranking increase or decrease?
--

If we examine the quantity $r - r^{(prev)}$, we get the following formula:

$$
\begin{align*}
n*\text{(ranking change)} &= \text{goal differential} - \left(\sum_{g \in games} \text{ranking} - \text{ranking of opponent in game g} \right)
\end{align*}
$$

<b>Proof:</b>

$$
\begin{align*}
r - r^{(prev)}&=\frac{1}{n}Sr^{(prev)} + \frac{1}{n}\Delta - r^{(prev)} \\
&=(\frac{1}{n}S-I)r^{(prev)} + \frac{1}{n}\Delta \\
n(r - r^{(prev)})&=(S-nI)r^{(prev)} + \Delta
\end{align*}
$$

The $i$'th term in the last line above is given as:

$$
\begin{align*}
n(r - r^{(prev)})_i&=\Delta_i - \left(\sum_{g \in games} r^{(prev)}_i-r^{(prev)}_{\text{opponent in game g}}\right) \\
\end{align*}
$$

$\blacksquare$


So a team's ranking will be unchanged if their goal differential is precisely the ranking difference between them and their opponents. If they score more goals than this ranking difference, their ranking will increase, otherwise it will decrease.

Conservation of total ranking
--

Another observation in this setting is that the sum of the rankings remains unchanged

$$\sum_i r_i=\sum_i r^{(prev)}_i$$

<b>Proof:</b>

First we rewrite $\sum_i r_i$ as $1^Tr$, which is more concise.

$$
\begin{align*}
1^T r&=\frac{1}{n}1^T(Sr^{(prev)}+\Delta) \\
&=\frac{1}{n}(1^TSr^{(prev)}+1^T\Delta) \\
&= \frac{1}{n}(n1^Tr^{(prev)}+0) &\text{Each team plays $n$ games, and the goal differentials sum to 0} \\
&= 1^Tr^{(prev)}
\end{align*}
$$

$\blacksquare$

b) Teams play a variable amount of games, no scoring cap
-------------------------


c) Score differential capped at 7
-------------------------